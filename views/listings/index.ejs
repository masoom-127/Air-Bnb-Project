<% layout('/layout/boiler.ejs') %>

<% if(alldata.length === 0){ %>
   <h4 class="text-center mt-4">No listings found</h4>
<% } %>

    <style>
       /* FILTER BAR  */
        #filters {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .filter {
            text-align: center;
            opacity: 0.7;
            cursor: pointer;
        }

        .filter:hover {
            opacity: 1;
        }

        .filter p {
            font-size: 0.8rem;
            margin-top: 0.2rem;
        }

        /* GST TOGGLE */
        .tax-info {
            display: none;
            color: gray;
            font-size: 0.9rem;
        }

        .tax-toggle {
            border: 1px solid black;
            border-radius: 2rem;
            padding: 0.7rem 1rem;
            display: flex;
            align-items: center;
            margin-left: 1rem;
        }
    </style>

    <!-- FILTER BAR  -->
    <div id="filters">

        <!-- All Listings -->
        <div class="filter" data-category="all">
            <i class="fa-solid fa-list"></i>
            <p>All</p>
        </div>

        <div class="filter" data-category="trend">
            <i class="fa-solid fa-fire"></i>
            <p>Trend</p>
        </div>

        <div class="filter" data-category="city">
            <i class="fa-solid fa-mountain-city"></i>
            <p>City</p>
        </div>

        <div class="filter" data-category="mountain">
            <i class="fa-solid fa-mountain"></i>
            <p>Mountain</p>
        </div>

        <div class="filter" data-category="pool">
            <i class="fa-solid fa-person-swimming"></i>
            <p>Pools</p>
        </div>

        <div class="filter" data-category="farm">
            <i class="fa-solid fa-tractor"></i>
            <p>Farms</p>
        </div>

        <!-- GST TOGGLE -->

        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="taxSwitch">
            <label class="form-check-label" for="taxSwitch">
                Display price after GST
            </label>
        </div>





    </div>

   <!-- listing -->
    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-4">

        <% for(let li of alldata){ %>
            <div class="col">
                <a href="/lists/<%= li._id %>" class="listing-link">

                    <div class="card listing-card" data-category="<%= li.category %>">

                        <img src="<%= li.image.url %>" class="card-img-top" style="height:20rem">

                        <div class="card-body">
                            <b>
                                <%= li.title %>
                            </b> <br>

                            â‚¹ <span class="base-price">
                                <%= li.price.toLocaleString('en-IN') %>
                            </span>

                            <span class="tax-info">
                                (+18% GST)
                            </span>
                        </div>

                    </div>
                </a>
            </div>
            <% } %>

    </div>

    <!-- ================= JAVASCRIPT ================= -->
    <script>
        // ================= GST Toggle =================
        const taxSwitch = document.getElementById("taxSwitch");
        const taxInfos = document.querySelectorAll(".tax-info");

        taxSwitch.addEventListener("change", () => {
            taxInfos.forEach(item => {
                item.style.display = taxSwitch.checked ? "inline" : "none";
            });
        });

        // ================= Category Filters =================
        const filters = document.querySelectorAll('.filter');
        const listingCols = document.querySelectorAll('.row .col'); // select the columns

        filters.forEach(filter => {
            filter.addEventListener('click', () => {
                const category = filter.dataset.category;

                listingCols.forEach(col => {
                    const card = col.querySelector('.listing-card');
                    const cardCategory = card.dataset.category;

                    if (category === "all" || cardCategory === category) {
                        col.style.display = ""; // reset to default, Bootstrap handles layout
                    } else {
                        col.style.display = "none"; // hide column
                    }
                });
            });
        });
    </script>